Submitted By: Jim Gifford (patches at jg555 dot com)
Date: 2005-12-23
Initial Package Version: 4.0.13
Origin: Jim Gifford
Upstream Status: Sent
Description: Fixes default values
	     As released libpam libselinux and audit are
	     turned on by default. This patch corrects
	     the issue.
	    
	     Fixes multilib linking issues.
 
diff -Naur shadow-4.0.13.orig/aclocal.m4 shadow-4.0.13/aclocal.m4
--- shadow-4.0.13.orig/aclocal.m4	2005-09-28 12:46:25.000000000 +0000
+++ shadow-4.0.13/aclocal.m4	2005-12-23 23:38:48.000000000 +0000
@@ -2636,21 +2636,8 @@
 shlibpath_overrides_runpath=unknown
 version_type=none
 dynamic_linker="$host_os ld.so"
-sys_lib_dlsearch_path_spec="/lib /usr/lib"
-if test "$GCC" = yes; then
-  sys_lib_search_path_spec=`$CC -print-search-dirs | grep "^libraries:" | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-  if echo "$sys_lib_search_path_spec" | grep ';' >/dev/null ; then
-    # if the path contains ";" then we assume it to be the separator
-    # otherwise default to the standard path separator (i.e. ":") - it is
-    # assumed that no part of a normal pathname contains ";" but that should
-    # okay in the real world where ";" in dirpaths is itself problematic.
-    sys_lib_search_path_spec=`echo "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
-  else
-    sys_lib_search_path_spec=`echo "$sys_lib_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-  fi
-else
-  sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
-fi
+sys_lib_dlsearch_path_spec="/lib /usr/lib /lib32 /usr/lib32 /lib64 /usr/lib64"
+sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib /lib32 /usr/lib32 /usr/local/lib32 /lib64 /usr/lib64 /usr/local/lib64"
 need_lib_prefix=unknown
 hardcode_into_libs=no
 
diff -Naur shadow-4.0.13.orig/configure shadow-4.0.13/configure
--- shadow-4.0.13.orig/configure	2005-09-28 12:46:31.000000000 +0000
+++ shadow-4.0.13/configure	2005-12-23 23:35:53.000000000 +0000
@@ -8082,21 +8082,8 @@
 shlibpath_overrides_runpath=unknown
 version_type=none
 dynamic_linker="$host_os ld.so"
-sys_lib_dlsearch_path_spec="/lib /usr/lib"
-if test "$GCC" = yes; then
-  sys_lib_search_path_spec=`$CC -print-search-dirs | grep "^libraries:" | $SED -e "s/^libraries://" -e "s,=/,/,g"`
-  if echo "$sys_lib_search_path_spec" | grep ';' >/dev/null ; then
-    # if the path contains ";" then we assume it to be the separator
-    # otherwise default to the standard path separator (i.e. ":") - it is
-    # assumed that no part of a normal pathname contains ";" but that should
-    # okay in the real world where ";" in dirpaths is itself problematic.
-    sys_lib_search_path_spec=`echo "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
-  else
-    sys_lib_search_path_spec=`echo "$sys_lib_search_path_spec" | $SED  -e "s/$PATH_SEPARATOR/ /g"`
-  fi
-else
-  sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
-fi
+sys_lib_dlsearch_path_spec="/lib /usr/lib /lib32 /usr/lib32 /lib64 /usr/lib64"
+sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib /lib32 /usr/lib32 /usr/local/lib32 /lib64 /usr/lib64 /usr/local/lib64"
 need_lib_prefix=unknown
 hardcode_into_libs=no
 
@@ -23268,7 +23255,7 @@
   withval="$with_audit"
   with_audit=$withval
 else
-  with_audit=yes
+  with_audit=no
 fi;
 
 # Check whether --with-libpam or --without-libpam was given.
@@ -23276,7 +23263,7 @@
   withval="$with_libpam"
   with_libpam=$withval
 else
-  with_libpam=yes
+  with_libpam=no
 fi;
 
 # Check whether --with-selinux or --without-selinux was given.
@@ -23284,7 +23271,7 @@
   withval="$with_selinux"
   with_selinux=$withval
 else
-  with_selinux=yes
+  with_selinux=no
 fi;
 
 # Check whether --with-skey or --without-skey was given.
diff -Naur shadow-4.0.13.orig/configure.in shadow-4.0.13/configure.in
--- shadow-4.0.13.orig/configure.in	2005-09-27 14:11:49.000000000 +0000
+++ shadow-4.0.13/configure.in	2005-12-23 23:33:39.000000000 +0000
@@ -220,13 +220,13 @@
 
 AC_ARG_WITH(audit, 
 	[AC_HELP_STRING([--with-audit], [use auditing support @<:@default=yes if found@:>@])],
-	[with_audit=$withval], [with_audit=yes])
+	[with_audit=$withval], [with_audit=no])
 AC_ARG_WITH(libpam,
 	[AC_HELP_STRING([--with-libpam], [use libpam for PAM support @<:@default=yes if found@:>@])],
-	[with_libpam=$withval], [with_libpam=yes])
+	[with_libpam=$withval], [with_libpam=no])
 AC_ARG_WITH(selinux,
 	[AC_HELP_STRING([--with-selinux], [use SELinux support @<:@default=autodetect@:>@])],
-	[with_selinux=$withval], [with_selinux=yes])
+	[with_selinux=$withval], [with_selinux=no])
 AC_ARG_WITH(skey,
 	[AC_HELP_STRING([--with-skey], [use S/Key support @<:@default=no@:>@])],
 	[with_skey=$withval], [with_skey=no])
