Submitted By: Jim Gifford (patches at jg555 dot com)
Date: 2005-07-02
Initial Package Version: 1.4.9
Origin: Jbit, mdh, and Jim Gifford
Upstream Status: Sent
Description: Allows Silo to be built under Cross-LFS
 
diff -Naur silo-1.4.9.orig/Rules.make silo-1.4.9/Rules.make
--- silo-1.4.9.orig/Rules.make	2005-03-15 16:41:01.000000000 +0000
+++ silo-1.4.9/Rules.make	2005-07-03 06:54:38.000000000 +0000
@@ -3,7 +3,8 @@
 RM=rm -f
 # We want to force 32-bit builds
 CC=gcc -m32
-LD=ld
+BUILD_CC=gcc
+LD=ld -m elf32_sparc
 AS=as
 STRIP=strip
 NM=nm
diff -Naur silo-1.4.9.orig/common/Makefile silo-1.4.9/common/Makefile
--- silo-1.4.9.orig/common/Makefile	2004-06-20 17:16:32.000000000 +0000
+++ silo-1.4.9/common/Makefile	2005-07-03 06:06:45.000000000 +0000
@@ -12,12 +12,15 @@
 
 OBJS = sdiv.o rem.o udiv.o urem.o jmp.o printf.o console.o prom.o tree.o stringops2.o\
 	stringops1.o ffs.o divdi3.o udivdi3.o
-PROGRAMS = bin2h
 
-all: $(OBJS) $(PROGRAMS)
+bin2h:
+	$(BUILD_CC) $(CFLAGS) -o bin2h bin2h.c
+
+all: $(OBJS) bin2h
 
 prom.o: prom.c
 	$(CC) $(CFLAGS) -c -Wa,-Av9 -o prom.o prom.c
 
 clean:
 	$(RM) $(PROGRAMS) *.o
+
diff -Naur silo-1.4.9.orig/first/Makefile silo-1.4.9/first/Makefile
--- silo-1.4.9.orig/first/Makefile	2003-12-04 02:29:23.000000000 +0000
+++ silo-1.4.9/first/Makefile	2005-07-03 08:42:18.000000000 +0000
@@ -10,7 +10,7 @@
 # Relocate to 2.5MB. The Hitchhiker's Guide to Open Boot Rev 3 claims
 # that 3MB are guaranteed to be mapped.
 # Changing this value will require changing a bunch of other constants throughout the code
-LDFLAGS=-N -Ttext 0x4000
+LDFLAGS=-N -Ttext 0x4000 -m elf32_sparc
 
 .S.o:
 	$(CC) $(CFLAGS) -c $*.S
diff -Naur silo-1.4.9.orig/second/Makefile silo-1.4.9/second/Makefile
--- silo-1.4.9.orig/second/Makefile	2004-06-20 17:16:32.000000000 +0000
+++ silo-1.4.9/second/Makefile	2005-07-03 08:42:02.000000000 +0000
@@ -23,8 +23,8 @@
 # that 3MB are guaranteed to be mapped.
 #
 # XXX: We seem to be going 4Megs here for LARGE? -- BenC
-LDFLAGS_SMALL=-N -Ttext $(SMALL_RELOC)
-LDFLAGS_LARGE=-N -Ttext $(LARGE_RELOC)
+LDFLAGS_SMALL=-N -Ttext $(SMALL_RELOC) -m elf32_sparc
+LDFLAGS_LARGE=-N -Ttext $(LARGE_RELOC) -m elf32_sparc
 
 .c.o:
 	$(CC) $(CFLAGS) -c $*.c -o $@
@@ -85,7 +85,7 @@
 	$(CC) $(CFLAGS) -c -o $@ $<
 
 util:	util.c
-	$(CC) -DSMALL_RELOC=$(SMALL_RELOC) -DLARGE_RELOC=$(LARGE_RELOC) -o $@ $<
+	$(BUILD_CC) -DSMALL_RELOC=$(SMALL_RELOC) -DLARGE_RELOC=$(LARGE_RELOC) -o $@ $<
 
 clean:
 	$(RM) *.o fs/*.o second* silotftp* util fs/libfs.a
